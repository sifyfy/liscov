# ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ãƒãƒ£ãƒƒãƒˆ (Milestone Chat) åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

## æ¦‚è¦

YouTubeãƒ©ã‚¤ãƒ–ãƒãƒ£ãƒƒãƒˆã«ãŠã‘ã‚‹ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ãƒãƒ£ãƒƒãƒˆï¼ˆ`liveChatMembershipItemRenderer`ï¼‰ã®ç”Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ã‚’åˆ†æã—ã€liscovã§ã®å¯¾å¿œæ–¹é‡ã‚’ã¾ã¨ã‚ã‚‹ã€‚

## ç”Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚µãƒ³ãƒ—ãƒ«

### ã‚µãƒ³ãƒ—ãƒ«1: çµµæ–‡å­—ã‚’å«ã‚€ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ãƒãƒ£ãƒƒãƒˆ (13ãƒ¶æœˆè¨˜å¿µ)

**ãƒ•ã‚¡ã‚¤ãƒ«**: `<XDG_DATA_DIR>/raw_responses_YYYYMMDD_HHMMSS.ndjson`
**ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—**: 1767338028

```json
{
  "liveChatMembershipItemRenderer": {
    "authorBadges": [
      {
        "liveChatAuthorBadgeRenderer": {
          "accessibility": {
            "accessibilityData": {
              "label": "Member (1 year)"
            }
          },
          "customThumbnail": {
            "thumbnails": [
              {
                "height": 16,
                "url": "https://yt3.ggpht.com/BADGE_THUMBNAIL_ID=s16-c-k",
                "width": 16
              },
              {
                "height": 32,
                "url": "https://yt3.ggpht.com/BADGE_THUMBNAIL_ID=s32-c-k",
                "width": 32
              }
            ]
          },
          "tooltip": "Member (1 year)"
        }
      }
    ],
    "authorExternalChannelId": "UCxxxxxxxxxxxxxxxxxxxxxxxxx",
    "authorName": {
      "simpleText": "@SampleUser1"
    },
    "authorPhoto": {
      "thumbnails": [
        {
          "height": 32,
          "url": "https://yt4.ggpht.com/AUTHOR_PHOTO_ID=s32-c-k-c0x00ffffff-no-rj",
          "width": 32
        },
        {
          "height": 64,
          "url": "https://yt4.ggpht.com/AUTHOR_PHOTO_ID=s64-c-k-c0x00ffffff-no-rj",
          "width": 64
        }
      ]
    },
    "headerPrimaryText": {
      "runs": [
        { "text": "Member for " },
        { "text": "13" },
        { "text": " months" }
      ]
    },
    "headerSubtext": {
      "simpleText": "ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼"
    },
    "id": "DUMMY_MESSAGE_ID_001",
    "message": {
      "runs": [
        {
          "emoji": {
            "emojiId": "ğŸ‘Š",
            "image": {
              "accessibility": {
                "accessibilityData": {
                  "label": "ğŸ‘Š"
                }
              },
              "thumbnails": [
                {
                  "url": "https://fonts.gstatic.com/s/e/notoemoji/15.1/1f44a/72.png"
                }
              ]
            },
            "searchTerms": ["oncoming", "fist", "facepunch", "punch"],
            "shortcuts": [":oncoming_fist:", ":facepunch:", ":punch:"],
            "supportsSkinTone": true,
            "variantIds": ["ğŸ‘Š", "ğŸ‘ŠğŸ»", "ğŸ‘ŠğŸ¼", "ğŸ‘ŠğŸ½", "ğŸ‘ŠğŸ¾", "ğŸ‘ŠğŸ¿"]
          }
        }
      ]
    },
    "timestampUsec": "1767338026816689",
    "trackingParams": "DUMMY_TRACKING_PARAMS_001"
  }
}
```

### ã‚µãƒ³ãƒ—ãƒ«2: è¤‡æ•°ã®çµµæ–‡å­—ã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å«ã‚€ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ãƒãƒ£ãƒƒãƒˆ (1ãƒ¶æœˆè¨˜å¿µ)

**ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—**: 1767338059

```json
{
  "liveChatMembershipItemRenderer": {
    "authorBadges": [
      {
        "liveChatAuthorBadgeRenderer": {
          "accessibility": {
            "accessibilityData": {
              "label": "Member (1 month)"
            }
          },
          "customThumbnail": {
            "thumbnails": [
              {
                "height": 16,
                "url": "https://yt3.ggpht.com/BADGE_THUMBNAIL_ID_2=s16-c-k",
                "width": 16
              },
              {
                "height": 32,
                "url": "https://yt3.ggpht.com/BADGE_THUMBNAIL_ID_2=s32-c-k",
                "width": 32
              }
            ]
          },
          "tooltip": "Member (1 month)"
        }
      }
    ],
    "authorExternalChannelId": "UCyyyyyyyyyyyyyyyyyyyyyyyyy",
    "authorName": {
      "simpleText": "@SampleUser2"
    },
    "authorPhoto": {
      "thumbnails": [
        {
          "height": 32,
          "url": "https://yt4.ggpht.com/AUTHOR_PHOTO_ID_2=s32-c-k-c0x00ffffff-no-rj",
          "width": 32
        },
        {
          "height": 64,
          "url": "https://yt4.ggpht.com/AUTHOR_PHOTO_ID_2=s64-c-k-c0x00ffffff-no-rj",
          "width": 64
        }
      ]
    },
    "headerPrimaryText": {
      "runs": [
        { "text": "Member for 1 month" }
      ]
    },
    "headerSubtext": {
      "simpleText": "ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼"
    },
    "id": "DUMMY_MESSAGE_ID_002",
    "message": {
      "runs": [
        {
          "emoji": {
            "emojiId": "ğŸ‘Š",
            "image": {
              "accessibility": {
                "accessibilityData": {
                  "label": "ğŸ‘Š"
                }
              },
              "thumbnails": [
                {
                  "url": "https://fonts.gstatic.com/s/e/notoemoji/15.1/1f44a/72.png"
                }
              ]
            },
            "searchTerms": ["oncoming", "fist", "facepunch", "punch"],
            "shortcuts": [":oncoming_fist:", ":facepunch:", ":punch:"],
            "supportsSkinTone": true,
            "variantIds": ["ğŸ‘Š", "ğŸ‘ŠğŸ»", "ğŸ‘ŠğŸ¼", "ğŸ‘ŠğŸ½", "ğŸ‘ŠğŸ¾", "ğŸ‘ŠğŸ¿"]
          }
        },
        {
          "emoji": {
            "emojiId": "ğŸ‘Š",
            "image": {...},
            ...
          }
        },
        {
          "emoji": {
            "emojiId": "ğŸ‘Š",
            "image": {...},
            ...
          }
        },
        {
          "emoji": {
            "emojiId": "ğŸ‘Š",
            "image": {...},
            ...
          }
        },
        {
          "text": "ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
        }
      ]
    },
    "timestampUsec": "1767338058096889",
    "trackingParams": "DUMMY_TRACKING_PARAMS_002"
  }
}
```

### ã‚µãƒ³ãƒ—ãƒ«3: æ–°è¦ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ² (Welcome)

```json
{
  "liveChatMembershipItemRenderer": {
    "authorBadges": [...],
    "authorExternalChannelId": "UCzzzzzzzzzzzzzzzzzzzzzzzzz",
    "authorName": {
      "simpleText": "@SampleUser3"
    },
    "authorPhoto": {...},
    "headerSubtext": {
      "runs": [
        { "text": "Welcome to ", "emoji": null },
        { "text": "ã‚µãƒ³ãƒ—ãƒ«ãƒãƒ£ãƒ³ãƒãƒ«", "emoji": null },
        { "text": "!", "emoji": null }
      ]
    },
    "id": "DUMMY_MESSAGE_ID_003",
    "message": null,
    "timestampUsec": "1767084627649165",
    "trackingParams": "DUMMY_TRACKING_PARAMS_003"
  }
}
```

## ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ã®ç‰¹å¾´

### 1. `headerSubtext` ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³

`headerSubtext`ã«ã¯2ç¨®é¡ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒå­˜åœ¨ã™ã‚‹:

| ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ | ä¾‹ | ç”¨é€” |
|-------------|-----|------|
| `simpleText` | `{"simpleText":"ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼"}` | ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ãƒ†ã‚£ã‚¢å |
| `runs` | `{"runs":[{"text":"Welcome to "},{"text":"ãƒãƒ£ãƒ³ãƒãƒ«å"},{"text":"!"}]}` | æ–°è¦ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |

### 2. `headerPrimaryText` ã®å­˜åœ¨

- **ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³è¨˜å¿µã®å ´åˆ**: å­˜åœ¨ã™ã‚‹ï¼ˆä¾‹: `"Member for 13 months"`ï¼‰
- **æ–°è¦ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²ã®å ´åˆ**: å­˜åœ¨ã—ãªã„ï¼ˆ`null` ã¾ãŸã¯æ¬ è½ï¼‰

### 3. `message` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ãŸå ´åˆ**: `runs`é…åˆ—ã‚’æŒã¤
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãªã—ã®å ´åˆ**: `null`

`message.runs`ã®æ§‹é€ :
```json
{
  "runs": [
    { "emoji": {...} },      // çµµæ–‡å­—ã®ã¿
    { "text": "ãƒ†ã‚­ã‚¹ãƒˆ" },   // ãƒ†ã‚­ã‚¹ãƒˆã®ã¿
    { "text": null, "emoji": {...} }  // æ˜ç¤ºçš„ãªnull
  ]
}
```

## ç¾åœ¨ã®liscovå®Ÿè£…ã®å•é¡Œç‚¹

### å•é¡Œ1: `headerSubtext`ã®`simpleText`å½¢å¼ãŒæœªå¯¾å¿œ

**ç¾åœ¨ã®`Message`æ§‹é€ ä½“** (`src/api/innertube/get_live_chat.rs`):
```rust
pub struct Message {
    pub runs: Vec<MessageRun>,
}
```

`simpleText`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒãªã„ãŸã‚ã€`{"simpleText":"ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼"}`å½¢å¼ã®ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã«å•é¡ŒãŒç”Ÿã˜ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

### å•é¡Œ2: `extract_message_text`ãŒçµµæ–‡å­—ã‚’ç„¡è¦–

**ç¾åœ¨ã®å®Ÿè£…** (`src/gui/models.rs`):
```rust
fn extract_message_text(runs: &[MessageRun]) -> String {
    runs.iter()
        .filter_map(|run| run.get_text().map(|s| s.to_string()))
        .collect::<Vec<_>>()
        .join("")
}
```

ã“ã®é–¢æ•°ã¯ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã‚’æŠ½å‡ºã—ã€çµµæ–‡å­—ã¯ç„¡è¦–ã•ã‚Œã‚‹ã€‚`content`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«çµµæ–‡å­—ãŒå«ã¾ã‚Œãªã„ã€‚

### å•é¡Œ3: ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ãƒãƒ£ãƒƒãƒˆã®runsæ§‹ç¯‰ã¯æ­£å¸¸

**ç¾åœ¨ã®å®Ÿè£…** (`src/gui/models.rs`):
```rust
let runs = if let Some(msg) = &renderer.message {
    msg.runs
        .iter()
        .filter_map(|run| {
            if let Some(text) = run.get_text() {
                Some(MessageRun::Text { content: text.to_string() })
            } else if let Some(emoji) = run.get_emoji() {
                // çµµæ–‡å­—ã‚‚æ­£ã—ãå‡¦ç†ã—ã¦ã„ã‚‹
                Some(MessageRun::Emoji { ... })
            } else {
                None
            }
        })
        .collect()
} else {
    Vec::new()
};
```

`runs`ã®æ§‹ç¯‰ã¯çµµæ–‡å­—ã‚’æ­£ã—ãå‡¦ç†ã—ã¦ã„ã‚‹ã€‚

## ä¿®æ­£æ–¹é‡

### æ–¹é‡1: `Message`æ§‹é€ ä½“ã®æ‹¡å¼µ

`simpleText`å½¢å¼ã«ã‚‚å¯¾å¿œã™ã‚‹ãŸã‚ã€`Message`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´:

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct Message {
    #[serde(default)]
    pub runs: Vec<MessageRun>,
    #[serde(rename = "simpleText", skip_serializing_if = "Option::is_none")]
    pub simple_text: Option<String>,
}

impl Message {
    /// runsã¾ãŸã¯simpleTextã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
    pub fn get_text(&self) -> String {
        if let Some(text) = &self.simple_text {
            text.clone()
        } else {
            self.runs.iter()
                .filter_map(|run| run.get_text().map(|s| s.to_string()))
                .collect::<Vec<_>>()
                .join("")
        }
    }
}
```

### æ–¹é‡2: `extract_message_text`ã®ä¿®æ­£ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

çµµæ–‡å­—ã®altãƒ†ã‚­ã‚¹ãƒˆã‚’å«ã‚ã‚‹å ´åˆ:

```rust
fn extract_message_text(runs: &[MessageRun]) -> String {
    runs.iter()
        .filter_map(|run| {
            if let Some(text) = run.get_text() {
                Some(text.to_string())
            } else if let Some(emoji) = run.get_emoji() {
                // çµµæ–‡å­—ã®altãƒ†ã‚­ã‚¹ãƒˆã¾ãŸã¯IDã‚’å«ã‚ã‚‹
                Some(emoji.emoji_id.clone())
            } else {
                None
            }
        })
        .collect::<Vec<_>>()
        .join("")
}
```

### æ–¹é‡3: UIã§ã®è¡¨ç¤ºç¢ºèª

ç¾åœ¨ã®`runs`æ§‹ç¯‰ã¯æ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ãŸã‚ã€UIå´ã§`runs`ã‚’æ­£ã—ãæç”»ã—ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ã€‚

## çµ±è¨ˆæƒ…å ±

**åˆ†æå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**: ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ« (ç´„104MB)

| ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ— | ä»¶æ•° |
|-----------------|------|
| `liveChatTextMessageRenderer` | 34,804 |
| `liveChatAuthorBadgeRenderer` | 20,916 |
| `liveChatMembershipItemRenderer` | 59 |
| `liveChatPaidMessageRenderer` | 281 |
| `liveChatPaidStickerRenderer` | 6 |
| `liveChatPlaceholderItemRenderer` | 186 |
| `liveChatSponsorshipsGiftPurchaseAnnouncementRenderer` | 5 |
| `liveChatSponsorshipsGiftRedemptionAnnouncementRenderer` | 7 |
| `liveChatSponsorshipsHeaderRenderer` | 5 |
| `liveChatTickerPaidMessageItemRenderer` | 123 |
| `liveChatTickerSponsorItemRenderer` | 30 |

## å„ªå…ˆåº¦

1. **é«˜**: `Message`æ§‹é€ ä½“ã®`simpleText`å¯¾å¿œ
2. **ä¸­**: `extract_message_text`ã®çµµæ–‡å­—å¯¾å¿œï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
3. **ä½**: UIè¡¨ç¤ºã®æ¤œè¨¼

## å‚è€ƒæƒ…å ±

- **ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `<XDG_DATA_DIR>/`
- **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: `<XDG_CONFIG_DIR>/config.toml`
- **é–¢é€£ã‚³ãƒ¼ãƒ‰**:
  - `src/api/innertube/get_live_chat.rs` - APIãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ä½“
  - `src/gui/models.rs` - GUIç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¤‰æ›
